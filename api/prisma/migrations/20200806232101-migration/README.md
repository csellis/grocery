# Migration `20200806232101-migration`

This migration has been generated by Chris Ellis at 8/6/2020, 7:21:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "Store" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"name" TEXT NOT NULL,
"userId" TEXT NOT NULL,
FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "StoreCategory" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"order" INTEGER NOT NULL,
"categoryId" INTEGER NOT NULL,
"storeId" INTEGER NOT NULL,
FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("storeId") REFERENCES "Store"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

PRAGMA foreign_keys=off;
DROP TABLE "UserExample";;
PRAGMA foreign_keys=on

CREATE TABLE "new_User" (
"id" TEXT NOT NULL,
"email" TEXT NOT NULL,
"name" TEXT ,
PRIMARY KEY ("id"))

INSERT INTO "new_User" ("id", "email", "name") SELECT "id", "email", "name" FROM "User"

PRAGMA foreign_keys=off;
DROP TABLE "User";;
PRAGMA foreign_keys=on

ALTER TABLE "new_User" RENAME TO "User";

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200804094815-migration..20200806232101-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,23 +1,14 @@
 datasource DS {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
   binaryTargets = env("BINARY_TARGET")
 }
-// Define your own datamodels here and run `yarn redwood db save` to create
-// migrations for them.
-// TODO: Please remove the following example:
-model UserExample {
-  id    Int     @id @default(autoincrement())
-  email String  @unique
-  name  String?
-}
-
 model Category {
   id    Int    @id @default(autoincrement())
   name  String
   items Item[]
@@ -32,13 +23,30 @@
   createdAt  DateTime @default(now())
   updatedAt  DateTime @updatedAt
 }
+model Store {
+  id     Int    @id @default(autoincrement())
+  name   String
+  user   User   @relation(fields: [userId], references: [id])
+  userId String
+}
+
+model StoreCategory {
+  id         Int      @id @default(autoincrement())
+  order      Int
+  category   Category @relation(fields: [categoryId], references: [id])
+  categoryId Int
+  store      Store    @relation(fields: [storeId], references: [id])
+  storeId    Int
+}
+
 model User {
-  id    String     @id @default(uuid())
-  email String     @unique
-  name  String?
-  items UserItem[]
+  id     String     @id @default(uuid())
+  email  String     @unique
+  name   String?
+  items  UserItem[]
+  stores Store[]
 }
 model UserItem {
   id           Int      @id @default(autoincrement())
```


