# Migration `20200724095158-migration`

This migration has been generated by Chris Ellis at 7/24/2020, 9:51:58 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."UserItem" (
"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"itemId" INTEGER NOT NULL  ,"itemName" TEXT NOT NULL  ,"picked" BOOLEAN NOT NULL DEFAULT false ,"updatedAt" DATE NOT NULL  ,"userId" TEXT NOT NULL  ,FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."new_User" (
"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"email" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"name" TEXT   ,"updatedAt" DATE NOT NULL  ,
    PRIMARY KEY ("id"))

INSERT INTO "quaint"."new_User" ("email", "id", "name") SELECT "email", "id", "name" FROM "quaint"."User"

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."User";;
PRAGMA foreign_keys=on

ALTER TABLE "quaint"."new_User" RENAME TO "User";

CREATE UNIQUE INDEX "quaint"."User.email" ON "User"("email")

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."ItemsOnUser";;
PRAGMA foreign_keys=on

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200723141317-migration..20200724095158-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource DS {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
@@ -16,30 +16,33 @@
   email String  @unique
   name  String?
 }
+// This is the canonical items
 model Item {
-  id        Int           @id @default(autoincrement())
+  id        Int      @id @default(autoincrement())
   name      String
-  published Boolean       @default(true)
-  createdAt DateTime      @default(now())
-  updatedAt DateTime      @updatedAt
-  users     ItemsOnUser[]
+  published Boolean  @default(true)
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
 }
 model User {
-  id    String        @id @default(uuid())
-  email String        @unique
-  name  String?
-  items ItemsOnUser[]
+  id        String     @id @default(uuid())
+  email     String     @unique
+  name      String?
+  items     UserItem[]
+  createdAt DateTime   @default(now())
+  updatedAt DateTime   @updatedAt
 }
-model ItemsOnUser {
-  item      Item     @relation(fields: [itemId], references: [id])
-  itemId    Int
+// not tightly coupled via m-n relationship
+model UserItem {
+  id        Int      @id @default(autoincrement())
   user      User     @relation(fields: [userId], references: [id])
   userId    String
+  itemName  String
+  itemId    Int
+  picked    Boolean  @default(false)
   createdAt DateTime @default(now())
-  picked    Boolean  @default(false)
-
-  @@id([itemId, userId])
+  updatedAt DateTime @updatedAt
 }
```


